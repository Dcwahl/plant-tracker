<!DOCTYPE html>
<html>
<head>
	<title>New Batch - Plant Tracker</title>
	<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
	<style>
		body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
		h1 { color: #2d5016; }
		.nav { margin-bottom: 20px; }
		.nav a { margin-right: 15px; padding: 8px 15px; text-decoration: none; background: #f0f0f0; border-radius: 4px; }
		form { background: #f9f9f9; padding: 20px; border-radius: 5px; }
		.form-group { margin-bottom: 15px; }
		label { display: block; margin-bottom: 5px; font-weight: bold; }
		input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
		.btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; }
		.btn-primary { background: #4CAF50; color: white; }
		.btn-secondary { background: #999; color: white; margin-left: 10px; }
		.form-actions { margin-top: 20px; }
		.species-detail { font-size: 12px; color: #666; }
		/* Hide Tom Select input when item is selected */
		.ts-control .item ~ input { display: none !important; }
	</style>
</head>
<body>
	<div class="nav">
		<a href="/">Batches</a>
		<a href="/species">Species</a>
	</div>

	<h1>New Germination Batch</h1>

	{{if .Species}}
	<form method="POST" action="/batches/create">
		<div class="form-group">
			<label for="species_id">Species *</label>
			<select id="species_id" name="species_id" required>
				<option value="">Select a species...</option>
				{{range .Species}}
				<option value="{{.ID}}">
					{{.Name}}{{if .StratificationSteps}} - {{range $index, $step := .StratificationSteps}}{{if $index}} â†’ {{end}}{{$step.Type}}{{if $step.Moist}}(M){{end}} {{$step.Days}}d{{end}}{{end}}
				</option>
				{{end}}
			</select>
		</div>

		<div class="form-group">
			<label for="num_cells">Number of Cells *</label>
			<input type="number" id="num_cells" name="num_cells" min="1" required>
		</div>

		<div class="form-group">
			<label for="seeds_per_cell">Seeds per Cell *</label>
			<input type="number" id="seeds_per_cell" name="seeds_per_cell" min="1" required>
		</div>

		<div class="form-group">
			<label for="total_seeds">Total Seeds (optional)</label>
			<input type="number" id="total_seeds" name="total_seeds" min="1">
		</div>

		<div class="form-group">
			<label for="date_created">Date *</label>
			<input type="date" id="date_created" name="date_created" value="{{.TodayDate}}" required>
		</div>

		<div class="form-actions">
			<button type="submit" class="btn btn-primary">Create Batch</button>
			<a href="/" class="btn btn-secondary">Cancel</a>
		</div>
	</form>
	{{else}}
	<p>You need to <a href="/species/new">create at least one species</a> before you can create a batch.</p>
	<a href="/species/new" class="btn btn-primary">Create Species</a>
	{{end}}

	<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
	<script>
		{{if .Species}}
		new TomSelect('#species_id', {
			placeholder: 'Search for a species...',
			create: false,
			maxItems: 1,
			maxOptions: 50,
			closeAfterSelect: true
		});
		{{end}}
	</script>
</body>
</html>
